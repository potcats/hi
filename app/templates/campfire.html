<!DOCTYPE html>

<!--
Carrie Ko, Christine Chen, Cindy Liu, Joyce Lin
hi
SoftDev
P02: Makers Makin' It, Act I
01/16/2026
-->

<html>

<head>

  <title> CAMPFIRE </title>

  <!-- CUSTOM CSS -->
  <link rel="stylesheet"
    type="text/css"
    href="/static/css/style.css">

  <!-- BOOTSTRAP CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
    crossorigin="anonymous">

  <!-- PAGE SPECIFIC CSS -->
  <style>
    /* BACKGROUND */
    body {
      background-image: url("/static/images/bgs/campsite.jpg");
      background-repeat: no-repeat;
      background-size: 100vw 100vh;

      font-family: font;
    }

    /* AUDIO */
    #audio {
      transform: scale(5);
      display: none;
      margin-top: 15px;
      margin-left: 25px;
    }

    #audio:checked + label img {
      content: url("/static/images/icons/audio.png");
      filter: invert(80%);
    }

    /* TURN INDICATOR */
    #turn {
      position: absolute;

      top: 0;
      right: 10px;

      color: Gainsboro;
    }

    /* MODAL STUFF */
    .mod {
      display: none;
    }

    #close {
      position: absolute;
      bottom: 2.7em;
      left: 10px;

      width: 23%;
      height: 10%;

      border-style: solid;
      border-width: thick;
      border-color: dimgrey;

      background-color: grey
    }

    #sell {
      position: absolute;
      bottom: 2.7em;

      width: 23%;
      height: 10%;

      border-style: none;
      background-color: firebrick;
    }

    #sell:hover {
      filter: brightness(120%);
    }

    #close:hover, #next:hover, .inv:hover:not(.sellable), .inspect:hover {
      background-color: darkgrey;
    }

    /* INVENTORY STUFF */
    #bp {
      width: 100px;
      height: auto;

      position: absolute;
      top: 3em;
      right: 10px;
    }

    #bp:hover {
      transform: scale(125%);
    }

    #inv {
      width: 50%;
      height: 90vh;
      padding: 20px;
      padding-bottom: 10px;

      background-color: dimgrey;
    }

    .inv {
      width: 100%;
      height: 10vh;

      font-size: 125%;

      border-style: none;
      background-color: grey;
    }

    .sellable {
      background-color: firebrick;
    }

    .sellable:hover {
      filter: brightness(120%);
    }

    .inspect {
      align-self: right;

      width: 23%;
      height: 10%;

      border-style: solid;
      border-width: thick;
      border-color: dimgrey;

      background-color: grey
    }

    /* LEVELS + GENERAL STATS CONTAINER */
    #levelsOut {
      width: 23%;
      padding: 5px;
      padding-bottom: 0;

      position: absolute;
      top: 3em;
      left: 10px;

      background-color: dimgrey;
    }

    #levelsIn {
      width: 90%;

      margin-top: 1em;
      margin-right: 15px;

      background-color: grey;
    }

    /* CHARACTER DISPLAY */
    #charOut {
      width: 23%;
      padding: 20px;

      position: absolute;
      top: 3em;
      right: 10px;

      background-color: dimgrey;
    }

    #charIn {
      width: 90%;

      background-color: grey;
    }

    /* PROCEED BUTTON */
    #next {
      position: absolute;
      bottom: 1.5em;
      right : 20px;

      width: 15%;
      height: 10%;

      border-style: solid;
      border-width: thick;
      border-color: dimgrey;

      background-color: grey
    }

  </style>

</head>

<body>
  <!-- AUDIO -->
  <audio loop id="bgm" src="/static/sound/campsite.mp3"> </audio>

  <input type="checkbox" id="audio" onclick="Aud()" style="border-style: none;">
  <label id='audiobut' for="audio">
    <img style="width: 50px; height: auto; position: absolute; left: 5px; top: -6px; filter: invert(80%);"
      src="/static/images/icons/mute.png">
  </label>

  <!-- TURN INDICATOR -->
  <h2 id="turn"> TURN {{ currTurn }}/4 </h2>

  <!-- NEXT ENCOUNTER BUTTON -->
  <button onclick="window.location.href='encounters'" id="next">
    CONTINUE
  </button>

  <!-- INVENTORY BUTTON -->
  <button onclick="openMod()" style="border-style: none; background: none;">
    <img src="/static/images/icons/backpack.png" id="bp">
  </button>

  <!-- MODAL CLOSE BUTTON -->
  <button class="mod" onclick="closeMod()" id="close" style="left: 10px;">
    CLOSE
  </button>

  <!-- SELL BUTTON -->
  <button class="mod" onclick="toggleSellMode()" id="sell" style="right: 10px;">
    SELL
  </button>

  <!-- LEVELS + GENERAL STATS -->
  <div class="container mod" id="levelsOut">
    <div class="container" id="levelsIn">
      <h3 style="text-align: center; margin-top: 10px;"> {{ username }} </h3>
      <text> HP: {{ HP }}/{{ maxHP }} </text> <br>
      <text> Level: {{ lvl }} ({{currXP}}/{{reqXP}}) </text> <br>
      <br>
      <text> STR: {{ str }} </text> <br>
      <text> DEX: {{ dex }} </text> <br>
      <text> CON: {{ con }} </text> <br>
      <text> INT: {{ int }} </text> <br>
      <text> FTH: {{ fth }} </text> <br>
      <text> LCK: {{ lck }} </text> <br>
      <br>
      <!-- temp range -->
      <text> INITIATIVE: 4 -- 7 </text> <br>
      <br>
    </div>
    <br>
  </div>

  <!-- MAIN INVENTORY -->
  <div class="container mod" id="inv">
    <div class="container overflow-auto" style="height: 60%">
      {% for item in inventory %}
        <button class="center inv" id="{{ item }}" onclick="clicked(this)"> {{ item }} </button>
        <br>
      {% endfor %}
    </div>
    <div class="container" id="inspect" style="height: 40%">
      <div class="container overflow-auto" style="height: 90%; padding: 15px">
        <!-- IF NO ITEMS SELECTED -->
        <h3 class="center" style="text-align: center; display: none;" id="noInspect">
          SELECT AN ITEM TO INSPECT
        </h3>

        <!-- ITEMS SELECTED -->
        <h3 style="text-align: center;" id="itemName"> </h3>
        <p id="itemDesc"> </p>
        <div id="extension"> </div>
      </div>
      <div class="container" style="height: 10%">
        <!-- SELL BUTTON -->
        <button class="inspect" id="inspectSell" onclick="sell()" style="display: none">
          SELL
        </button>

        <!-- USE BUTTON -->
        <button class="inspect" id="inspectUse" onclick="use()" style="display: none">
          USE
        </button>

        <!-- SELL BUTTON -->
        <button class="inspect" id="inspectEquip" onclick="equip()" style="display: none">
          EQUIP
        </button>
      </div>
    </div>
  </div>

  <!-- CHARACTER DISPLAY -->
  <div class="container mod" id="charOut">
    <div class="container" id="charIn" style="overflow: hidden">
      <img src="/static/images/warrior-nosword.png" style="position: relative;
        z-index: 0; margin-left: -135px; margin-bottom: -60px;">
    </div>
  </div>

  <!-- BOOTSTRAP JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
    crossorigin="anonymous"> </script>

  <!-- PAGE-SPECIFIC JS -->
  <script>
    var inv = {{ inventory | tojson }};
    var selectedItm = "";
    var sellMode = false;

    /* EVENTS THAT WILL OCCUR ON LOAD */
    window.onload = function() {
      document.getElementById('audio').checked = false;
    };

    /* AUDIO BUTTON INTERACTIONS */
    var Aud = function() {
      let bgm = document.getElementById('bgm');
      if (bgm.paused) {
        bgm.play();
      }
      else {
        bgm.pause();
      }
    };

    /* OPEN MODAL */
    function openMod() {
      modalWindows = document.getElementsByClassName("mod");

      for (modal of modalWindows) {
        modal.style.display = "block";
      }

      document.getElementById('close').style.display = "block";
      document.getElementById('next').style.display = "none";

      document.getElementById('noInspect').style.display = "block";
    }

    /* CLOSE MODAL */
    function closeMod() {
      modalWindows = document.getElementsByClassName("mod");

      for (modal of modalWindows) {
        modal.style.display = "none";
      }

      document.getElementById('close').style.display = "none";
      document.getElementById('next').style.display = "block";

      document.getElementById("inspectSell").style.display = "none";
      document.getElementById("inspectUse").style.display = "none";
      document.getElementById("inspectEquip").style.display = "none";
    }

    /* SELL MODE */
    function toggleSellMode() {
      items = document.getElementsByClassName("inv");

      if (sellMode) {
        sellMode = false;
        document.getElementById('sell').style.backgroundColor = "firebrick"

        for (item of items) {
          item.classList.remove("sellable");
        }
      } else {
        sellMode = true;
        document.getElementById('sell').style.backgroundColor = "forestgreen"

        for (item of items) {
          item.classList.add("sellable");
        }
      }
    }

    /* ITEM INTERACTIONS */
    function clicked(itm) {
      let select = new XMLHttpRequest();
      name = itm.id

      document.getElementById('noInspect').style.display = "none";
      document.getElementById('itemName').innerHTML = inv[name][0];
      document.getElementById('itemDesc').innerHTML = inv[name][5];

      if (inv[name][0] == "consumable") {
        select.open('POST', window.location.href, true);
        select.setRequestHeader("select", "consumable," + name);
        select.send();

        cont = document.getElementById("extension")
        textExtension = "<p> EFFECTS </p><br>"

        select.onload = function() {
          if (this.readyState == 4 && this.status == 200) {
            effects = this.response.split(",");
          };

          textExtension += "<text> HP: " + effects[0] + "</text><br>";
          textExtension += "<text> ENERGY: " + effects[1] + "</text><br>";

          cont.innerHTML = textExtension;
        }

        if (sellMode) { document.getElementById("inspectSell").style.display = "block"
        } else { document.getElementById("inspectUse").style.display = "block" };
      } else {
        select.open('POST', window.location.href, true);
        select.setRequestHeader("select", "gear," + name);
        select.send();

        cont = document.getElementById("extension")
        textExtension = "<p> STATS </p><br>"

        select.onload = function() {
          if (this.readyState == 4 && this.status == 200) {
            stats = this.response.split(",");
          };

          textExtension += "<text> STR: " + stats[0] + "</text><br>";
          textExtension += "<text> CON: " + stats[1] + "</text><br>";
          textExtension += "<text> DEX: " + stats[2] + "</text><br>";
          textExtension += "<text> INT: " + stats[3] + "</text><br>";
          textExtension += "<text> FTH: " + stats[4] + "</text><br>";
          textExtension += "<text> LCK: " + stats[5] + "</text><br>";

          cont.innerHTML = textExtension;
        }

        if (sellMode) { document.getElementById("inspectSell").style.display = "block"
        } else { document.getElementById("inspectUse").style.display = "block" };
      }
    }

    function sell() {
      let sell = new XMLHttpRequest();

    }

    function use() {
      let use = new XMLHttpRequest();

    }

    function equip() {
      let equip = new XMLHttpRequest();

    }

  </script>

</body>

</html>
