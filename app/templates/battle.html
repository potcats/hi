<!DOCTYPE html>

<!--
Carrie Ko, Christine Chen, Cindy Liu, Joyce Lin
hi
SoftDev
P02: Makers Makin' It, Act I
01/16/2026
-->

<html>

<head>

  <title> BATTLE </title>

  <!-- CUSTOM CSS -->
  <link rel="stylesheet"
    type="text/css"
    href="/static/css/style.css">

  <!-- BOOTSTRAP CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
    crossorigin="anonymous">

  <!-- PAGE SPECIFIC CSS -->
  <style>

    body {
      background: url('/static/images/bgs/forestpath.jpg');
      background-size: cover;
      background-position: center;
      position: relative;
      overflow: hidden;
      font-family: font;
    }

    .enemy-wrap, .player-wrap {
      position: absolute;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .panel {
      position: absolute;
      bottom: 105px;
      left: 50%;
      transform: translateX(-50%);
      width: 600px;
      background: gray;
      padding: 10px;
    }

    .panel-btn {
      background: gray;
      border: none;
      color: white;
      padding: 5px;
      cursor: pointer;
    }

    .atk-wrap {
      background: gray;
      color: white;
      border-radius: 6px;
      display: flex;
      align-items: center;
      cursor: pointer;
    }

    .items-grid {
      display: grid;
      gap: 20px;
    }

    .slot {
      width: 50px;
      height: 50px;
      border: 2px solid white;
      border-radius: 6px;
      cursor: pointer;
    }

    .slot.empty {
      cursor: default;
    }

    .slot:hover {
      outline: 2px solid white;
    }

  </style>

</head>

<body>

  <div class = "container-fluid vh-100 d-flex flex-column px-0">

    <!-- Left-Side Bar -->
    <div class = "row flex-grow-1 position-relative">

      <div class= "text-white" style = "position: absolute; top: 30%; left: 0; width: 200px;">
        <h5 class = "fw-bold text-center"> Turn {{ battle.turn }} </h5>

        <div class = "p-3 bg-dark">
          <div class = "mb-3">
            <h5 class = "fw-bold"> {{ battle.player.name }} </h5>
            <div class = "progress">
              <div class = "progress-bar bg-danger" style = "width: {{ (battle.player.hp / 30) * 100 }}%">
                {{ battle.player.hp }} / {{ battle.player.max_hp }}
              </div>
            </div>
            <div class = "progress">
              <div class = "progress-bar bg-info" style = "width: {{ (battle.player.energy / 6) * 100 }}%">
                {{ battle.player.energy }} / 6
              </div>
            </div>
          </div>

          {% for enemy in battle.enemies %}
          <div class = "mb-3">
            <h5 class = "fw-bold"> {{ enemy.species }} </h5>
            <div class = "progress">
              <div class = "progress-bar bg-danger" style = "width: {{ (enemy.hp / enemy.max_hp) * 100 }}%">
                {{ enemy.hp }} / {{ enemy.max_hp }}
              </div>
            </div>
            <div class = "progress">
              <div class = "progress-bar bg-info" style = "width: {{ (enemy.energy / 6) * 100 }}%">
                {{ enemy.energy }} / 6
              </div>
            </div>
          </div>
          {% endfor %}
        </div>

      </div>

      <div class = "flex-grow-1 position-relative">

        <!-- Player Display -->
        <div class = "player-wrap" style = "left: 20%; bottom: 150px;">

          <img class = "player-sprite" src = "/static/images/warrior.png" style = "width: 200px;">

          <div class = "d-flex justify-content-center" style = "position: absolute; bottom: -20px; left: -60px;">
            <div class = "bg-dark text-white px-1" style = "border-radius: 8px; width: 200px;">

              <span class = "fw-bold small"> Warrior </span>

              <div class = "d-flex gap-1 mb-1">
                <div class = "progress flex-grow-1" style = "height: 12px;">
                  <div class = "progress-bar bg-danger" style = "width: {{ (battle.player.hp / 30) * 100 }}%">
                    <small>{{ battle.player.hp }} / {{ battle.player.max_hp }} </small>
                  </div>
                </div>
                <div class = "progress flex-grow-1" style = "height: 12px;">
                  <div class = "progress-bar bg-info" style = "width: {{ (battle.player.energy / 6) * 100 }}%">
                    <small>{{ battle.player.energy }} / 6 </small>
                  </div>
                </div>
              </div>

            </div>
          </div>

        </div>

        <!-- Enemy Display -->
        {% for enemy in battle.enemies %}
        <div class = "enemy-wrap"
             style = "right: {{ 15 + loop.index0 * 8 }}%; bottom: {{ 140 + loop.index0 * 60 }}px;">

          <img class = "enemy-sprite" src = "/static/images/enemies/{{ enemy.species }}.png" style = "width: 200px;">

          <div class = "d-flex justify-content-center" style = "position: absolute; bottom: -20px; left: -60px;">
            <div class = "bg-dark text-white px-1" style = "border-radius: 8px; width: 200px;">

              <span class = "fw-bold small"> {{ enemy.species }} </span>

              <div class = "d-flex gap-1 mb-1">
                <div class = "progress flex-grow-1" style = "height: 12px;">
                  <div class = "progress-bar bg-danger" style = "width: {{ (enemy.hp / enemy.max_hp) * 100 }}%">
                    <small> {{ enemy.hp }} / {{ enemy.max_hp }} </small>
                  </div>
                </div>
                <div class = "progress flex-grow-1" style = "height: 12px;">
                  <div class = "progress-bar bg-info" style = "width: {{ (enemy.energy / 6) * 100 }}%">
                    <small> {{ enemy.energy }} / 6 </small>
                  </div>
                </div>
              </div>

            </div>
          </div>

        </div>
        {% endfor %}

      </div>

    </div>

    <!-- Actions Bar -->
    <div class = "d-flex justify-content-center">
      <div class = "bg-dark text-white py-2" style = "width: 600px;">

        <div class = "d-flex justify-content-between align-items-center mx-3">
          <div>
            <h5 class = "fw-bold"> Warrior &nbsp Lvl {{ battle.player.level }} </h5>
            <!-- XP? -->
          </div>
          <div class = "d-flex align-items-center gap-1">
            <!-- Time? -->
            <h5 class = "fw-bold"> 0 </h5> <!-- Gold -->
            <img class = "mb-2" src = "/static/images/icons/coin.png" style = "width: 20px;">
          </div>
        </div>

        <div class = "d-flex gap-2 mb-2 mx-3">
          <div class = "progress flex-grow-1" style = "height: 18px;">
            <div class = "progress-bar bg-danger" style = "width: {{ (battle.player.hp / 30) * 100 }}%">
              {{ battle.player.hp }} / {{ battle.player.max_hp }}
            </div>
          </div>
          <div class = "progress flex-grow-1" style = "height: 18px;">
            <div class = "progress-bar bg-info" style = "width: {{ (battle.player.energy / 6) * 100 }}%">
              {{ battle.player.energy }} / 6
            </div>
          </div>
        </div>

        <div class = "d-flex gap-3 justify-content-center mx-3">
          <button class = "panel-btn fw-bold flex-grow-1" onclick = "show('attacks')"> Fight </button>
          <button class = "panel-btn fw-bold flex-grow-1" onclick = "show('items')"> Items </button>
          <button class = "panel-btn fw-bold flex-grow-1" onclick = "gainEnergy()"> Focus </button>
        </div>

      </div>
    </div>

    <!-- Attack Panel-->
    <div id = "attacks-panel" class = "panel" style = "display: none;">
      <div class = "d-flex gap-2 justify-content-center">
      {% for atk in battle.player.attacks %}
      <div class = "atk-wrap flex-grow-1 bg-dark px-2 gap-2 mb-1 py-1" onclick = "selectAtk('{{ atk }}')">
        <img src = "/static/images/icons/atk-icon.png" style = "width: 50px;">
        <div>
          <div class = "fw-bold"> {{ atk }} </div>
          <p style = "font-size: 10px;"> Cost: ? | Cooldown: ? </p>
        </div>
      </div>
      {% endfor %}
      </div>
    </div>

    <!-- Targets Panel -->
    <div id = "targets-panel" class = "panel" style = "display: none;">
      <div class = "d-flex gap-2 justify-content-center">

        {% for enemy in battle.enemies %}
        <div class = "atk-wrap flex-grow-1 bg-dark px-2 gap-2 mb-1 py-1" onclick = "selectTarget({{ loop.index0 }})">
          <div class = "fw-bold">{{ enemy.species }}</div>
          <div class = "progress flex-grow-1" style = "height: 15px;">
            <div class = "progress-bar bg-danger" style = "width: {{ (enemy.hp / enemy.max_hp) * 100 }}%">
              {{ enemy.hp }} / {{ enemy.max_hp }}
            </div>
          </div>
        </div>
        {% endfor %}

        <button class = "panel-btn" onclick = "show('attacks')"> Back </button>

      </div>
    </div>

    <!-- Items Panel -->
    <div id = "items-panel" class = "panel" style = "display: none;">
      <div class = "items-grid" style = "grid-template-columns: repeat(8, 1fr);">
        {% for item in battle.player.inventory %}
        <div class = "slot bg-dark d-flex flex-column align-items-center justify-content-center"
              onclick = "useItem(item)">
          <img src = "/static/images/gear/boots/cloth.png" style = "width: 32px; height: 32px;">
        </div>
        {% endfor %}
        {% for i in range(8 - battle.player.inventory|length) %}
        <div class = "slot empty"></div>
        {% endfor %}
      </div>
    </div>

  <!-- BOOTSTRAP JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
    crossorigin="anonymous"> </script>

  <!-- PAGE-SPECIFIC JS -->
  <script>
  let selected = null;

  function hide() {
    document.querySelectorAll('.panel')
      .forEach(p => p.style.display = 'none');
  }

  function show(type) {
    hide();
    document.getElementById(type + '-panel').style.display = 'block';
  }

  function selectAtk(atk) {
    selected = atk;
    show('targets');
  }

  function gainEnergy() {
    hide();
  }

  </script>

</body>

</html>
